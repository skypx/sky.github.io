<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Skypx</title>
    <meta name="description" content="">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_8v3czwksspqlg14i.css">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://localhost:4000/">
    <link rel="alternate" type="application/rss+xml" title="Skypx" href="http://localhost:4000/feed.xml ">



    <script>
    // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-72449510-4', 'auto');
      ga('send', 'pageview');

    </script>



</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">Skypx</a>
        <small>Talk is cheap，show me the code</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a class="active" href="/">
                        
                        <i class="fa fa-home"></i>主页
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>文章
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>类型
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>标签
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>关于
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" index>
    <div class="left">
        <h1>Welcome to Sky's Blog!</h1>
        <small>当你的才华配不上你的理想的时候, 就静下心来好好学习!</small>
        <hr>
        <ul>
            
              <li>
                <h2>
                  <a class="post-link" href="/2019/06/21/data_android&scroll/">Android ScrollTo, ScrollBy</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2019-06-21
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Android" title="Category: Android" rel="category">Android</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#Android" title="Tag: Android" rel="tag">Android</a>&nbsp;
    
        <a href="/tag/#Scroll" title="Tag: Scroll" rel="tag">Scroll</a>&nbsp;
    
        <a href="/tag/#方法" title="Tag: 方法" rel="tag">方法</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#scrollto与scrollby的区别" id="markdown-toc-scrollto与scrollby的区别">scrollTo与scrollBy的区别</a></li>
</ul>

<blockquote>
  <p>详解Android 中的ScrollTo, ScrollBy方法</p>
</blockquote>

<ol>
  <li>首先看一下网上的一些答案以及说法:
scrollTo(-x,-y), scrollBy(-x,-y), 如果传入负值就向正方向移动,传入正值向负方向移动
还有说移动的是里面的内容, 为什么会这样呢.
总结一句话就是,移动的方向和你传入的正负数相反的方向. 可有没有想过为什么会这样? 本篇将解释为什么会这样. 下面的一些图片更直观的</li>
</ol>

<p><img src="https://github.com/skypx/BlogResource/raw/master/view/scrool1.png" alt="avatar" />
<img src="https://github.com/skypx/BlogResource/raw/master/view/scrool2.png" alt="avatar" />
<img src="https://github.com/skypx/BlogResource/raw/master/view/scrool3.png" alt="avatar" />
<img src="https://github.com/skypx/BlogResource/raw/master/view/scrool4.png" alt="avatar" /></p>

<blockquote>
  <p>源码分析</p>
</blockquote>

<ol>
  <li>scrollTo, scrollBy 源码</li>
</ol>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cm">/**
     * Set the scrolled position of your view. This will cause a call to
     * {@link #onScrollChanged(int, int, int, int)} and the view will be
     * invalidated.
     * @param x the x position to scroll to
     * @param y the y position to scroll to
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">scrollTo</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mScrollX</span> <span class="o">!=</span> <span class="n">x</span> <span class="o">||</span> <span class="n">mScrollY</span> <span class="o">!=</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">oldX</span> <span class="o">=</span> <span class="n">mScrollX</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">oldY</span> <span class="o">=</span> <span class="n">mScrollY</span><span class="o">;</span>
            <span class="n">mScrollX</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
            <span class="n">mScrollY</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
            <span class="n">invalidateParentCaches</span><span class="o">();</span>
            <span class="n">onScrollChanged</span><span class="o">(</span><span class="n">mScrollX</span><span class="o">,</span> <span class="n">mScrollY</span><span class="o">,</span> <span class="n">oldX</span><span class="o">,</span> <span class="n">oldY</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">awakenScrollBars</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">postInvalidateOnAnimation</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Move the scrolled position of your view. This will cause a call to
     * {@link #onScrollChanged(int, int, int, int)} and the view will be
     * invalidated.
     * @param x the amount of pixels to scroll by horizontally
     * @param y the amount of pixels to scroll by vertically
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">scrollBy</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">scrollTo</span><span class="o">(</span><span class="n">mScrollX</span> <span class="o">+</span> <span class="n">x</span><span class="o">,</span> <span class="n">mScrollY</span> <span class="o">+</span> <span class="n">y</span><span class="o">);</span>
    <span class="o">}</span>

</code></pre></div></div>
<p>原来scrollBy最终还是调用scrollTo，那我们接着来看scrollTo，scrollTo改变的是View的mScrollX和mScrollY这两个属性，我们来看下文档对这两个属性的解释：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="cm">/**
     * The offset, in pixels, by which the content of this view is scrolled
     * horizontally.
     * {@hide}
     */</span>
    <span class="nd">@ViewDebug</span><span class="o">.</span><span class="na">ExportedProperty</span><span class="o">(</span><span class="n">category</span> <span class="o">=</span> <span class="s">"scrolling"</span><span class="o">)</span>
    <span class="kd">protected</span> <span class="kt">int</span> <span class="n">mScrollX</span><span class="o">;</span>
    <span class="cm">/**
     * The offset, in pixels, by which the content of this view is scrolled
     * vertically.
     * {@hide}
     */</span>
    <span class="nd">@ViewDebug</span><span class="o">.</span><span class="na">ExportedProperty</span><span class="o">(</span><span class="n">category</span> <span class="o">=</span> <span class="s">"scrolling"</span><span class="o">)</span>
    <span class="kd">protected</span> <span class="kt">int</span> <span class="n">mScrollY</span><span class="o">;</span>
</code></pre></div></div>

<p>指的是View内容的偏移量，如果是ViewGroup的话作用的就是它的所有子view，如果是TextView的话则作用的就是TextView的内容。这两个api作用的对象是view的内容而不是view本身。</p>

<h2 id="scrollto与scrollby的区别">scrollTo与scrollBy的区别</h2>

<p>从上面源码，注意scrollTo(int x,int y)与scrollBy里的参数都是指偏移量，scrollTo是一步到位直接修改偏移量为x或y，而scrollBy是在当前偏移量加减x或y。这样说好像不是很准确，我们先来看下Android坐标系以及一些参数</p>

<p><img src="https://github.com/skypx/BlogResource/raw/master/view/zuobiao.png" alt="avatar" /></p>

<p>一般情况下View的坐标都是相对父ViewGroup，像以下的api：</p>

<ol>
  <li>getTop()</li>
  <li>getLeft()</li>
  <li>getRight()</li>
  <li>getBottom()</li>
  <li>getX()</li>
  <li>getY()</li>
</ol>

<p>是不是发现明明通过scrollTo设置的偏移量是-300，按照正常的逻辑以及android坐标系，应该向上移动，怎么还向下移动了呢，这时候我们就要深入源码来查看究竟了</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
     * Set the scrolled position of your view. This will cause a call to
     * {@link #onScrollChanged(int, int, int, int)} and the view will be
     * invalidated.
     * @param x the x position to scroll to
     * @param y the y position to scroll to
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">scrollTo</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mScrollX</span> <span class="o">!=</span> <span class="n">x</span> <span class="o">||</span> <span class="n">mScrollY</span> <span class="o">!=</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">oldX</span> <span class="o">=</span> <span class="n">mScrollX</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">oldY</span> <span class="o">=</span> <span class="n">mScrollY</span><span class="o">;</span>
            <span class="n">mScrollX</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
            <span class="n">mScrollY</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
            <span class="n">invalidateParentCaches</span><span class="o">();</span>
            <span class="n">onScrollChanged</span><span class="o">(</span><span class="n">mScrollX</span><span class="o">,</span> <span class="n">mScrollY</span><span class="o">,</span> <span class="n">oldX</span><span class="o">,</span> <span class="n">oldY</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">awakenScrollBars</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">postInvalidateOnAnimation</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>
<p>先来看看onScrollChanged</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
     * This is called in response to an internal scroll in this view (i.e., the
     * view scrolled its own contents). This is typically as a result of
     * {@link #scrollBy(int, int)} or {@link #scrollTo(int, int)} having been
     * called.
     *
     * @param l Current horizontal scroll origin.
     * @param t Current vertical scroll origin.
     * @param oldl Previous horizontal scroll origin.
     * @param oldt Previous vertical scroll origin.
     */</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onScrollChanged</span><span class="o">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">,</span> <span class="kt">int</span> <span class="n">t</span><span class="o">,</span> <span class="kt">int</span> <span class="n">oldl</span><span class="o">,</span> <span class="kt">int</span> <span class="n">oldt</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">notifySubtreeAccessibilityStateChangedIfNeeded</span><span class="o">();</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">AccessibilityManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">mContext</span><span class="o">).</span><span class="na">isEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">postSendViewScrolledAccessibilityEventCallback</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="n">mBackgroundSizeChanged</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="n">mDefaultFocusHighlightSizeChanged</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mForegroundInfo</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mForegroundInfo</span><span class="o">.</span><span class="na">mBoundsChanged</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">final</span> <span class="n">AttachInfo</span> <span class="n">ai</span> <span class="o">=</span> <span class="n">mAttachInfo</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ai</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ai</span><span class="o">.</span><span class="na">mViewScrollChanged</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">mListenerInfo</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">mListenerInfo</span><span class="o">.</span><span class="na">mOnScrollChangeListener</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mListenerInfo</span><span class="o">.</span><span class="na">mOnScrollChangeListener</span><span class="o">.</span><span class="na">onScrollChange</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">t</span><span class="o">,</span> <span class="n">oldl</span><span class="o">,</span> <span class="n">oldt</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>当View注册了OnScrollChangeListener，onScrollChange才会被调用。
接着就调用了postInvalidateOnAnimation</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
     * &lt;p&gt;Cause an invalidate to happen on the next animation time step, typically the
     * next display frame.&lt;/p&gt;
     *
     * &lt;p&gt;This method can be invoked from outside of the UI thread
     * only when this View is attached to a window.&lt;/p&gt;
     *
     * @see #invalidate()
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postInvalidateOnAnimation</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// We try only with the AttachInfo because there's no point in invalidating</span>
        <span class="c1">// if we are not attached to our window</span>
        <span class="kd">final</span> <span class="n">AttachInfo</span> <span class="n">attachInfo</span> <span class="o">=</span> <span class="n">mAttachInfo</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">attachInfo</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">attachInfo</span><span class="o">.</span><span class="na">mViewRootImpl</span><span class="o">.</span><span class="na">dispatchInvalidateOnAnimation</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>在来看看dispatchInvalidateOnAnimation的实现</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dispatchInvalidateOnAnimation</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mInvalidateOnAnimationRunnable</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">view</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div></div>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="kd">class</span> <span class="nc">InvalidateOnAnimationRunnable</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">mPosted</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">View</span><span class="o">&gt;</span> <span class="n">mViews</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">View</span><span class="o">&gt;();</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">AttachInfo</span><span class="o">.</span><span class="na">InvalidateInfo</span><span class="o">&gt;</span> <span class="n">mViewRects</span> <span class="o">=</span>
                <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">AttachInfo</span><span class="o">.</span><span class="na">InvalidateInfo</span><span class="o">&gt;();</span>
        <span class="kd">private</span> <span class="n">View</span><span class="o">[]</span> <span class="n">mTempViews</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">AttachInfo</span><span class="o">.</span><span class="na">InvalidateInfo</span><span class="o">[]</span> <span class="n">mTempViewRects</span><span class="o">;</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addView</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">mViews</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">view</span><span class="o">);</span>
                <span class="n">postIfNeededLocked</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addViewRect</span><span class="o">(</span><span class="n">AttachInfo</span><span class="o">.</span><span class="na">InvalidateInfo</span> <span class="n">info</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">mViewRects</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">info</span><span class="o">);</span>
                <span class="n">postIfNeededLocked</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeView</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">mViews</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">view</span><span class="o">);</span>

                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">mViewRects</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">--</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span> <span class="o">)</span> <span class="o">{</span>
                    <span class="n">AttachInfo</span><span class="o">.</span><span class="na">InvalidateInfo</span> <span class="n">info</span> <span class="o">=</span> <span class="n">mViewRects</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">info</span><span class="o">.</span><span class="na">target</span> <span class="o">==</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">mViewRects</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="n">info</span><span class="o">.</span><span class="na">recycle</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>

                <span class="k">if</span> <span class="o">(</span><span class="n">mPosted</span> <span class="o">&amp;&amp;</span> <span class="n">mViews</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">mViewRects</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
                    <span class="n">mChoreographer</span><span class="o">.</span><span class="na">removeCallbacks</span><span class="o">(</span><span class="n">Choreographer</span><span class="o">.</span><span class="na">CALLBACK_ANIMATION</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
                    <span class="n">mPosted</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="kt">int</span> <span class="n">viewCount</span><span class="o">;</span>
            <span class="kd">final</span> <span class="kt">int</span> <span class="n">viewRectCount</span><span class="o">;</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">mPosted</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

                <span class="n">viewCount</span> <span class="o">=</span> <span class="n">mViews</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">viewCount</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">mTempViews</span> <span class="o">=</span> <span class="n">mViews</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="n">mTempViews</span> <span class="o">!=</span> <span class="kc">null</span>
                            <span class="o">?</span> <span class="n">mTempViews</span> <span class="o">:</span> <span class="k">new</span> <span class="n">View</span><span class="o">[</span><span class="n">viewCount</span><span class="o">]);</span>
                    <span class="n">mViews</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                <span class="o">}</span>

                <span class="n">viewRectCount</span> <span class="o">=</span> <span class="n">mViewRects</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">viewRectCount</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">mTempViewRects</span> <span class="o">=</span> <span class="n">mViewRects</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="n">mTempViewRects</span> <span class="o">!=</span> <span class="kc">null</span>
                            <span class="o">?</span> <span class="n">mTempViewRects</span> <span class="o">:</span> <span class="k">new</span> <span class="n">AttachInfo</span><span class="o">.</span><span class="na">InvalidateInfo</span><span class="o">[</span><span class="n">viewRectCount</span><span class="o">]);</span>
                    <span class="n">mViewRects</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">viewCount</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">mTempViews</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">invalidate</span><span class="o">();</span>
                <span class="n">mTempViews</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">viewRectCount</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="n">View</span><span class="o">.</span><span class="na">AttachInfo</span><span class="o">.</span><span class="na">InvalidateInfo</span> <span class="n">info</span> <span class="o">=</span> <span class="n">mTempViewRects</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                <span class="n">info</span><span class="o">.</span><span class="na">target</span><span class="o">.</span><span class="na">invalidate</span><span class="o">(</span><span class="n">info</span><span class="o">.</span><span class="na">left</span><span class="o">,</span> <span class="n">info</span><span class="o">.</span><span class="na">top</span><span class="o">,</span> <span class="n">info</span><span class="o">.</span><span class="na">right</span><span class="o">,</span> <span class="n">info</span><span class="o">.</span><span class="na">bottom</span><span class="o">);</span>
                <span class="n">info</span><span class="o">.</span><span class="na">recycle</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kt">void</span> <span class="nf">postIfNeededLocked</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">mPosted</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">mChoreographer</span><span class="o">.</span><span class="na">postCallback</span><span class="o">(</span><span class="n">Choreographer</span><span class="o">.</span><span class="na">CALLBACK_ANIMATION</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
                <span class="n">mPosted</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>接着会调用run方法，其中有</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">viewCount</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">mTempViews</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">invalidate</span><span class="o">();</span>
                <span class="n">mTempViews</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
</code></pre></div></div>

<p>遍历所有添加进去的View，然后对每个View调用invalidate()，</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cm">/**
     * Invalidate the whole view. If the view is visible,
     * {@link #onDraw(android.graphics.Canvas)} will be called at some point in
     * the future.
     * &lt;p&gt;
     * This must be called from a UI thread. To call from a non-UI thread, call
     * {@link #postInvalidate()}.
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">invalidate</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">invalidate</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">invalidateInternal</span><span class="o">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">,</span> <span class="kt">int</span> <span class="n">t</span><span class="o">,</span> <span class="kt">int</span> <span class="n">r</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">invalidateCache</span><span class="o">,</span>
            <span class="kt">boolean</span> <span class="n">fullInvalidate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mGhostView</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mGhostView</span><span class="o">.</span><span class="na">invalidate</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">skipInvalidate</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">((</span><span class="n">mPrivateFlags</span> <span class="o">&amp;</span> <span class="o">(</span><span class="n">PFLAG_DRAWN</span> <span class="o">|</span> <span class="n">PFLAG_HAS_BOUNDS</span><span class="o">))</span> <span class="o">==</span> <span class="o">(</span><span class="n">PFLAG_DRAWN</span> <span class="o">|</span> <span class="n">PFLAG_HAS_BOUNDS</span><span class="o">)</span>
                <span class="o">||</span> <span class="o">(</span><span class="n">invalidateCache</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">mPrivateFlags</span> <span class="o">&amp;</span> <span class="n">PFLAG_DRAWING_CACHE_VALID</span><span class="o">)</span> <span class="o">==</span> <span class="n">PFLAG_DRAWING_CACHE_VALID</span><span class="o">)</span>
                <span class="o">||</span> <span class="o">(</span><span class="n">mPrivateFlags</span> <span class="o">&amp;</span> <span class="n">PFLAG_INVALIDATED</span><span class="o">)</span> <span class="o">!=</span> <span class="n">PFLAG_INVALIDATED</span>
                <span class="o">||</span> <span class="o">(</span><span class="n">fullInvalidate</span> <span class="o">&amp;&amp;</span> <span class="n">isOpaque</span><span class="o">()</span> <span class="o">!=</span> <span class="n">mLastIsOpaque</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">fullInvalidate</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">mLastIsOpaque</span> <span class="o">=</span> <span class="n">isOpaque</span><span class="o">();</span>
                <span class="n">mPrivateFlags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PFLAG_DRAWN</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="n">mPrivateFlags</span> <span class="o">|=</span> <span class="n">PFLAG_DIRTY</span><span class="o">;</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">invalidateCache</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">mPrivateFlags</span> <span class="o">|=</span> <span class="n">PFLAG_INVALIDATED</span><span class="o">;</span>
                <span class="n">mPrivateFlags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PFLAG_DRAWING_CACHE_VALID</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="c1">// Propagate the damage rectangle to the parent view.</span>
            <span class="kd">final</span> <span class="n">AttachInfo</span> <span class="n">ai</span> <span class="o">=</span> <span class="n">mAttachInfo</span><span class="o">;</span>
            <span class="kd">final</span> <span class="n">ViewParent</span> <span class="n">p</span> <span class="o">=</span> <span class="n">mParent</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">p</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">ai</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">r</span> <span class="o">&amp;&amp;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="n">Rect</span> <span class="n">damage</span> <span class="o">=</span> <span class="n">ai</span><span class="o">.</span><span class="na">mTmpInvalRect</span><span class="o">;</span>
                <span class="n">damage</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">t</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
                <span class="n">p</span><span class="o">.</span><span class="na">invalidateChild</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">damage</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="c1">// Damage the entire projection receiver, if necessary.</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">mBackground</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">mBackground</span><span class="o">.</span><span class="na">isProjected</span><span class="o">())</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="n">View</span> <span class="n">receiver</span> <span class="o">=</span> <span class="n">getProjectionReceiver</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">receiver</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">receiver</span><span class="o">.</span><span class="na">damageInParent</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

</code></pre></div></div>

<p>注意这个地方, 这个地方是绘制view面的内容,这也解释了为什么说是用scrollto 或者 scrollby来
移动里面的内容, 而不是这个view本身</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">p</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">ai</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">r</span> <span class="o">&amp;&amp;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="n">Rect</span> <span class="n">damage</span> <span class="o">=</span> <span class="n">ai</span><span class="o">.</span><span class="na">mTmpInvalRect</span><span class="o">;</span>
                <span class="n">damage</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">t</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
                <span class="n">p</span><span class="o">.</span><span class="na">invalidateChild</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">damage</span><span class="o">);</span>
            <span class="o">}</span>
</code></pre></div></div>

<p>接着</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
     * Don't call or override this method. It is used for the implementation of
     * the view hierarchy.
     *
     * @deprecated Use {@link #onDescendantInvalidated(View, View)} instead to observe updates to
     * draw state in descendants.
     */</span>
    <span class="nd">@Deprecated</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">invalidateChild</span><span class="o">(</span><span class="n">View</span> <span class="n">child</span><span class="o">,</span> <span class="kd">final</span> <span class="n">Rect</span> <span class="n">dirty</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">AttachInfo</span> <span class="n">attachInfo</span> <span class="o">=</span> <span class="n">mAttachInfo</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">attachInfo</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">attachInfo</span><span class="o">.</span><span class="na">mHardwareAccelerated</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// HW accelerated fast path</span>
            <span class="n">onDescendantInvalidated</span><span class="o">(</span><span class="n">child</span><span class="o">,</span> <span class="n">child</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">ViewParent</span> <span class="n">parent</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">attachInfo</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// If the child is drawing an animation, we want to copy this flag onto</span>
            <span class="c1">// ourselves and the parent to make sure the invalidate request goes</span>
            <span class="c1">// through</span>
            <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">drawAnimation</span> <span class="o">=</span> <span class="o">(</span><span class="n">child</span><span class="o">.</span><span class="na">mPrivateFlags</span> <span class="o">&amp;</span> <span class="n">PFLAG_DRAW_ANIMATION</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">;</span>

            <span class="c1">// Check whether the child that requests the invalidate is fully opaque</span>
            <span class="c1">// Views being animated or transformed are not considered opaque because we may</span>
            <span class="c1">// be invalidating their old position and need the parent to paint behind them.</span>
            <span class="n">Matrix</span> <span class="n">childMatrix</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="na">getMatrix</span><span class="o">();</span>
            <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">isOpaque</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="na">isOpaque</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">drawAnimation</span> <span class="o">&amp;&amp;</span>
                    <span class="n">child</span><span class="o">.</span><span class="na">getAnimation</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">childMatrix</span><span class="o">.</span><span class="na">isIdentity</span><span class="o">();</span>
            <span class="c1">// Mark the child as dirty, using the appropriate flag</span>
            <span class="c1">// Make sure we do not set both flags at the same time</span>
            <span class="kt">int</span> <span class="n">opaqueFlag</span> <span class="o">=</span> <span class="n">isOpaque</span> <span class="o">?</span> <span class="n">PFLAG_DIRTY_OPAQUE</span> <span class="o">:</span> <span class="n">PFLAG_DIRTY</span><span class="o">;</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">child</span><span class="o">.</span><span class="na">mLayerType</span> <span class="o">!=</span> <span class="n">LAYER_TYPE_NONE</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">mPrivateFlags</span> <span class="o">|=</span> <span class="n">PFLAG_INVALIDATED</span><span class="o">;</span>
                <span class="n">mPrivateFlags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PFLAG_DRAWING_CACHE_VALID</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">location</span> <span class="o">=</span> <span class="n">attachInfo</span><span class="o">.</span><span class="na">mInvalidateChildLocation</span><span class="o">;</span>
            <span class="n">location</span><span class="o">[</span><span class="n">CHILD_LEFT_INDEX</span><span class="o">]</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="na">mLeft</span><span class="o">;</span>
            <span class="n">location</span><span class="o">[</span><span class="n">CHILD_TOP_INDEX</span><span class="o">]</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="na">mTop</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">childMatrix</span><span class="o">.</span><span class="na">isIdentity</span><span class="o">()</span> <span class="o">||</span>
                    <span class="o">(</span><span class="n">mGroupFlags</span> <span class="o">&amp;</span> <span class="n">ViewGroup</span><span class="o">.</span><span class="na">FLAG_SUPPORT_STATIC_TRANSFORMATIONS</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">RectF</span> <span class="n">boundingRect</span> <span class="o">=</span> <span class="n">attachInfo</span><span class="o">.</span><span class="na">mTmpTransformRect</span><span class="o">;</span>
                <span class="n">boundingRect</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">dirty</span><span class="o">);</span>
                <span class="n">Matrix</span> <span class="n">transformMatrix</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">((</span><span class="n">mGroupFlags</span> <span class="o">&amp;</span> <span class="n">ViewGroup</span><span class="o">.</span><span class="na">FLAG_SUPPORT_STATIC_TRANSFORMATIONS</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Transformation</span> <span class="n">t</span> <span class="o">=</span> <span class="n">attachInfo</span><span class="o">.</span><span class="na">mTmpTransformation</span><span class="o">;</span>
                    <span class="kt">boolean</span> <span class="n">transformed</span> <span class="o">=</span> <span class="n">getChildStaticTransformation</span><span class="o">(</span><span class="n">child</span><span class="o">,</span> <span class="n">t</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">transformed</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">transformMatrix</span> <span class="o">=</span> <span class="n">attachInfo</span><span class="o">.</span><span class="na">mTmpMatrix</span><span class="o">;</span>
                        <span class="n">transformMatrix</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">getMatrix</span><span class="o">());</span>
                        <span class="k">if</span> <span class="o">(!</span><span class="n">childMatrix</span><span class="o">.</span><span class="na">isIdentity</span><span class="o">())</span> <span class="o">{</span>
                            <span class="n">transformMatrix</span><span class="o">.</span><span class="na">preConcat</span><span class="o">(</span><span class="n">childMatrix</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="n">transformMatrix</span> <span class="o">=</span> <span class="n">childMatrix</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">transformMatrix</span> <span class="o">=</span> <span class="n">childMatrix</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">transformMatrix</span><span class="o">.</span><span class="na">mapRect</span><span class="o">(</span><span class="n">boundingRect</span><span class="o">);</span>
                <span class="n">dirty</span><span class="o">.</span><span class="na">set</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">floor</span><span class="o">(</span><span class="n">boundingRect</span><span class="o">.</span><span class="na">left</span><span class="o">),</span>
                        <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">floor</span><span class="o">(</span><span class="n">boundingRect</span><span class="o">.</span><span class="na">top</span><span class="o">),</span>
                        <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">ceil</span><span class="o">(</span><span class="n">boundingRect</span><span class="o">.</span><span class="na">right</span><span class="o">),</span>
                        <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">ceil</span><span class="o">(</span><span class="n">boundingRect</span><span class="o">.</span><span class="na">bottom</span><span class="o">));</span>
            <span class="o">}</span>

            <span class="k">do</span> <span class="o">{</span>
                <span class="n">View</span> <span class="n">view</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">parent</span> <span class="k">instanceof</span> <span class="n">View</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">view</span> <span class="o">=</span> <span class="o">(</span><span class="n">View</span><span class="o">)</span> <span class="n">parent</span><span class="o">;</span>
                <span class="o">}</span>

                <span class="k">if</span> <span class="o">(</span><span class="n">drawAnimation</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">view</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">view</span><span class="o">.</span><span class="na">mPrivateFlags</span> <span class="o">|=</span> <span class="n">PFLAG_DRAW_ANIMATION</span><span class="o">;</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">parent</span> <span class="k">instanceof</span> <span class="n">ViewRootImpl</span><span class="o">)</span> <span class="o">{</span>
                        <span class="o">((</span><span class="n">ViewRootImpl</span><span class="o">)</span> <span class="n">parent</span><span class="o">).</span><span class="na">mIsAnimating</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span>

                <span class="c1">// If the parent is dirty opaque or not dirty, mark it dirty with the opaque</span>
                <span class="c1">// flag coming from the child that initiated the invalidate</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">view</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">((</span><span class="n">view</span><span class="o">.</span><span class="na">mViewFlags</span> <span class="o">&amp;</span> <span class="n">FADING_EDGE_MASK</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
                            <span class="n">view</span><span class="o">.</span><span class="na">getSolidColor</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">opaqueFlag</span> <span class="o">=</span> <span class="n">PFLAG_DIRTY</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="k">if</span> <span class="o">((</span><span class="n">view</span><span class="o">.</span><span class="na">mPrivateFlags</span> <span class="o">&amp;</span> <span class="n">PFLAG_DIRTY_MASK</span><span class="o">)</span> <span class="o">!=</span> <span class="n">PFLAG_DIRTY</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">view</span><span class="o">.</span><span class="na">mPrivateFlags</span> <span class="o">=</span> <span class="o">(</span><span class="n">view</span><span class="o">.</span><span class="na">mPrivateFlags</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">PFLAG_DIRTY_MASK</span><span class="o">)</span> <span class="o">|</span> <span class="n">opaqueFlag</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span>

                <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="na">invalidateChildInParent</span><span class="o">(</span><span class="n">location</span><span class="o">,</span> <span class="n">dirty</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">view</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// Account for transform on current parent</span>
                    <span class="n">Matrix</span> <span class="n">m</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="na">getMatrix</span><span class="o">();</span>
                    <span class="k">if</span> <span class="o">(!</span><span class="n">m</span><span class="o">.</span><span class="na">isIdentity</span><span class="o">())</span> <span class="o">{</span>
                        <span class="n">RectF</span> <span class="n">boundingRect</span> <span class="o">=</span> <span class="n">attachInfo</span><span class="o">.</span><span class="na">mTmpTransformRect</span><span class="o">;</span>
                        <span class="n">boundingRect</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">dirty</span><span class="o">);</span>
                        <span class="n">m</span><span class="o">.</span><span class="na">mapRect</span><span class="o">(</span><span class="n">boundingRect</span><span class="o">);</span>
                        <span class="n">dirty</span><span class="o">.</span><span class="na">set</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">floor</span><span class="o">(</span><span class="n">boundingRect</span><span class="o">.</span><span class="na">left</span><span class="o">),</span>
                                <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">floor</span><span class="o">(</span><span class="n">boundingRect</span><span class="o">.</span><span class="na">top</span><span class="o">),</span>
                                <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">ceil</span><span class="o">(</span><span class="n">boundingRect</span><span class="o">.</span><span class="na">right</span><span class="o">),</span>
                                <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">ceil</span><span class="o">(</span><span class="n">boundingRect</span><span class="o">.</span><span class="na">bottom</span><span class="o">));</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">parent</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>会有这样的一行代码：parent = parent.invalidateChildInParent(location, dirty);</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="n">ViewParent</span> <span class="nf">invalidateChildInParent</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">location</span><span class="o">,</span> <span class="n">Rect</span> <span class="n">dirty</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">mHostView</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">dirty</span><span class="o">.</span><span class="na">offset</span><span class="o">(</span><span class="n">location</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">location</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
                <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">mHostView</span> <span class="k">instanceof</span> <span class="n">ViewGroup</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">location</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
                    <span class="n">location</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
                    <span class="kt">int</span><span class="o">[]</span> <span class="n">offset</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">getOffset</span><span class="o">(</span><span class="n">offset</span><span class="o">);</span>
                    <span class="n">dirty</span><span class="o">.</span><span class="na">offset</span><span class="o">(</span><span class="n">offset</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">offset</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
                    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">invalidateChildInParent</span><span class="o">(</span><span class="n">location</span><span class="o">,</span> <span class="n">dirty</span><span class="o">);</span>
                <span class="o">}</span>

                <span class="k">this</span><span class="o">.</span><span class="na">invalidate</span><span class="o">(</span><span class="n">dirty</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="cm">/**
     * Mark the area defined by dirty as needing to be drawn. If the view is
     * visible, {@link #onDraw(android.graphics.Canvas)} will be called at some
     * point in the future.
     * &lt;p&gt;
     * This must be called from a UI thread. To call from a non-UI thread, call
     * {@link #postInvalidate()}.
     * &lt;p&gt;
     * &lt;b&gt;WARNING:&lt;/b&gt; In API 19 and below, this method may be destructive to
     * {@code dirty}.
     *
     * @param dirty the rectangle representing the bounds of the dirty region
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">invalidate</span><span class="o">(</span><span class="n">Rect</span> <span class="n">dirty</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="kt">int</span> <span class="n">scrollX</span> <span class="o">=</span> <span class="n">mScrollX</span><span class="o">;</span>
        <span class="kd">final</span> <span class="kt">int</span> <span class="n">scrollY</span> <span class="o">=</span> <span class="n">mScrollY</span><span class="o">;</span>
        <span class="n">invalidateInternal</span><span class="o">(</span><span class="n">dirty</span><span class="o">.</span><span class="na">left</span> <span class="o">-</span> <span class="n">scrollX</span><span class="o">,</span> <span class="n">dirty</span><span class="o">.</span><span class="na">top</span> <span class="o">-</span> <span class="n">scrollY</span><span class="o">,</span>
                <span class="n">dirty</span><span class="o">.</span><span class="na">right</span> <span class="o">-</span> <span class="n">scrollX</span><span class="o">,</span> <span class="n">dirty</span><span class="o">.</span><span class="na">bottom</span> <span class="o">-</span> <span class="n">scrollY</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div></div>

<p><strong>这个地方都是减去scrollX 和减去scrollY, 当你传入负数的时候就是正值了,所以, 我们就和开篇对应起来了, 传入负数向正方向移动, 传入正数向负方向移动</strong></p>

<p>参考: <a href="https://www.jianshu.com/p/ce618bebb043">https://www.jianshu.com/p/ce618bebb043</a></p>

                </div>
                <div class="read-all">
                    <a  href="/2019/06/21/data_android&scroll/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2019/06/20/data_Mac$Gedit/">Mac 下安装gedit</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2019-06-20
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#工具" title="Category: 工具" rel="category">工具</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#Mac" title="Tag: Mac" rel="tag">Mac</a>&nbsp;
    
        <a href="/tag/#Gedit" title="Tag: Gedit" rel="tag">Gedit</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#1可通过-httpsgeditensoftoniccommac-安装" id="markdown-toc-1可通过-httpsgeditensoftoniccommac-安装">1.可通过 https://gedit.en.softonic.com/mac 安装</a></li>
  <li><a href="#2通过下面的连接安装" id="markdown-toc-2通过下面的连接安装">2.通过下面的连接安装</a></li>
</ul>

<blockquote>
  <p>Mac 下安装 Gedit</p>
</blockquote>

<h2 id="1可通过-httpsgeditensoftoniccommac-安装">1.可通过 <a href="https://gedit.en.softonic.com/mac">https://gedit.en.softonic.com/mac</a> 安装</h2>

<ol>
  <li>open -e .bash_profile</li>
  <li>alias gedit=”sudo open -a gedit”</li>
  <li>source .bash_profile</li>
  <li>
    <p>如果出现打不开“gedit”，因为它来自身份不明的开发者。的问题：参考</p>

    <p><a href="https://jingyan.baidu.com/article/f71d60377960651ab741d140.html">https://jingyan.baidu.com/article/f71d60377960651ab741d140.html</a></p>
  </li>
</ol>

<p>关于open 命令</p>

<ul>
  <li>open，使用关联的程序打开文件，例：open a.txt会用文本编辑打开a.txt，open b.jpg会使用预览打开b.jpg</li>
  <li>open -e，强制使用文本编辑程序打开文件</li>
  <li>open -a，自行选择程序打开文件，例：open -a Preview b.jpg会使用预览打开b.jpg，另外使用此命令输入已安装的程序名可直接打开，而open则需要知道程序存放的路径才行，例：open -a Preview等同于open /Applications/Preview.app</li>
</ul>

<p>但是我用这种方式安装之后打开的一次之后，在次打开的话一定要完全退出上次的软件， 所以很不舒服，下面介绍第二种方式安装</p>

<h2 id="2通过下面的连接安装">2.通过下面的连接安装</h2>

<p><a href="http://macappstore.org/gedit/">http://macappstore.org/gedit/</a></p>

<p>我并没有用<strong>brew cask install gedit</strong>这个命令安装
用<strong>brew install gedit</strong>这个命令，会安装很多依赖，大约5分钟左右</p>

<p>然后就可以gedit文件了，这个界面比通过<a href="https://gedit.en.softonic.com/mac">softonic</a>这种方式的安装界面漂亮多了</p>

                </div>
                <div class="read-all">
                    <a  href="/2019/06/20/data_Mac$Gedit/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2019/06/20/data_Linux$Mac&Terminal%E9%A2%9C%E8%89%B2%E4%BF%AE%E6%94%B9/">Linux 与 Mac下的Terminal颜色修改</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2019-06-20
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#工具" title="Category: 工具" rel="category">工具</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#Terminal" title="Tag: Terminal" rel="tag">Terminal</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    
<ul>
  <li>默认的PS1 配置</li>
</ul>

<p>代码块
英文状态下直接按左上角就可以，一定是英文状态
中文状态下shit+option+左上角，</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">echo</span> <span class="n">$PS1</span>
<span class="err">\</span><span class="nl">h:</span><span class="err">\</span><span class="n">W</span> <span class="err">\</span><span class="n">u</span><span class="err">\$</span>
</code></pre></div></div>
<p><img src="https://github.com/skypx/BlogResource/raw/master/other/normalterminal.png" alt="avatar" /></p>

<ul>
  <li>修改PS1的配置文件</li>
</ul>

<ol>
  <li>Linux系统中修改.bashrc, 添加下面的代码
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PS1</span><span class="o">=</span><span class="err">'$</span><span class="o">{</span><span class="nl">debian_chroot:</span><span class="o">+(</span><span class="n">$debian_chroot</span><span class="o">)}</span><span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="n">e</span><span class="o">]</span><span class="mi">2</span><span class="o">;</span><span class="err">\</span><span class="n">w</span><span class="err">\</span><span class="n">a</span><span class="err">\</span><span class="o">]</span><span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="mo">033</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">35</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="err">\</span><span class="n">u</span><span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="mo">033</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">37</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="err">@\</span><span class="o">[</span><span class="err">\</span><span class="mo">033</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">34</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="err">\</span><span class="n">h</span> <span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="mo">033</span><span class="o">[</span><span class="mo">00</span><span class="n">m</span><span class="err">\</span><span class="o">]:</span> <span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="mo">033</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">33</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="err">\</span><span class="n">w</span> <span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="n">e</span><span class="o">[</span><span class="mo">00</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="n">e</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">36</span><span class="n">m</span><span class="err">\</span><span class="o">][</span><span class="err">\</span><span class="n">t</span> <span class="err">\</span><span class="n">d</span><span class="o">]</span> <span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="n">e</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">32</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="n">No</span><span class="o">.</span><span class="err">\#</span><span class="o">(</span><span class="err">\</span><span class="o">!)</span><span class="err">\</span><span class="n">n</span><span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="n">e</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">31</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="err">\$</span> <span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="mo">033</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">37</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="err">'</span>
</code></pre></div>    </div>
  </li>
  <li>Mac中修改.bash_profile. 同样添加上面的代码
下面的这是是我的配置，我只是把上面的代码颜色改了
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">export</span> <span class="n">PS1</span><span class="o">=</span><span class="err">'$</span><span class="o">{</span><span class="nl">debian_chroot:</span><span class="o">+(</span><span class="n">$debian_chroot</span><span class="o">)}</span><span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="n">e</span><span class="o">]</span><span class="mi">2</span><span class="o">;</span><span class="err">\</span><span class="n">w</span><span class="err">\</span><span class="n">a</span><span class="err">\</span><span class="o">]</span><span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="mo">033</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">35</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="err">\</span><span class="n">u</span><span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="mo">033</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">35</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="err">@\</span><span class="o">[</span><span class="err">\</span><span class="mo">033</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">35</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="err">\</span><span class="n">h</span> <span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="mo">033</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">35</span><span class="n">m</span><span class="err">\</span><span class="o">]:</span> <span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="n">e</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">36</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="err">\</span><span class="n">w</span> <span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="n">e</span><span class="o">[</span><span class="mo">00</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="n">e</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">36</span><span class="n">m</span><span class="err">\</span><span class="o">][</span><span class="err">\</span><span class="n">t</span> <span class="err">\</span><span class="n">d</span><span class="o">]</span> <span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="n">e</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">32</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="n">No</span><span class="o">.</span><span class="err">\#</span><span class="o">(</span><span class="err">\</span><span class="o">!)</span><span class="err">\</span><span class="n">n</span><span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="n">e</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">31</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="err">\$</span> <span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="mo">033</span><span class="o">[</span><span class="mo">01</span><span class="o">;</span><span class="mi">37</span><span class="n">m</span><span class="err">\</span><span class="o">]</span><span class="err">'</span>
</code></pre></div>    </div>
    <p><img src="https://github.com/skypx/BlogResource/raw/master/other/changeterminal.png" alt="avatar" /></p>
  </li>
</ol>

<p>这样就可以显示时间，和历史命令的是第几条的terminal了，是不是很酷</p>

                </div>
                <div class="read-all">
                    <a  href="/2019/06/20/data_Linux$Mac&Terminal%E9%A2%9C%E8%89%B2%E4%BF%AE%E6%94%B9/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2019/06/15/data_video&audio&sync/">Video and Audio 的同步处理</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2019-06-15
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Camera" title="Category: Camera" rel="category">Camera</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#Video" title="Tag: Video" rel="tag">Video</a>&nbsp;
    
        <a href="/tag/#and" title="Tag: and" rel="tag">and</a>&nbsp;
    
        <a href="/tag/#Audio" title="Tag: Audio" rel="tag">Audio</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#问题描述" id="markdown-toc-问题描述">问题描述</a></li>
  <li><a href="#思考" id="markdown-toc-思考">思考,</a></li>
  <li><a href="#核心思路涉及公司代码-不能上传code" id="markdown-toc-核心思路涉及公司代码-不能上传code">核心思路(涉及公司代码, 不能上传code)</a></li>
</ul>

<blockquote>
  <p>前言之需要了解的东西</p>
</blockquote>

<ul>
  <li>
    <p>MediaCodec
MediaCodec类Android提供的用于访问低层多媒体编/解码器接口，它是Android低层多媒体架构的一部分，通常与MediaExtractor、MediaMuxer、AudioTrack结合使用，能够编解码诸如H.264、H.265、AAC、3gp等常见的音视频格式。广义而言，MediaCodec的工作原理就是处理输入数据以产生输出数据。具体来说，MediaCodec在编解码的过程中使用了一组输入/输出缓存区来同步或异步处理数据：首先，客户端向获取到的编解码器输入缓存区写入要编解码的数据并将其提交给编解码器，待编解码器处理完毕后将其转存到编码器的输出缓存区，同时收回客户端对输入缓存区的所有权；然后，客户端从获取到编解码输出缓存区读取编码好的数据进行处理，待处理完毕后编解码器收回客户端对输出缓存区的所有权。不断重复整个过程，直至编码器停止工作或者异常退出</p>
  </li>
  <li>
    <p>MediaMuxer
就是对音频和视频的混合. 来生成MP4 或 其它格式的文件</p>
  </li>
</ul>

<p>没有数据源,比如是从surface出来的
MediaCodec is typically used like this in asynchronous mode:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MediaCodec</span> <span class="n">codec</span> <span class="o">=</span> <span class="n">MediaCodec</span><span class="o">.</span><span class="na">createByCodecName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
 <span class="n">MediaFormat</span> <span class="n">mOutputFormat</span><span class="o">;</span> <span class="c1">// member variable</span>
 <span class="n">codec</span><span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">MediaCodec</span><span class="o">.</span><span class="na">Callback</span><span class="o">()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kt">void</span> <span class="nf">onInputBufferAvailable</span><span class="o">(</span><span class="n">MediaCodec</span> <span class="n">mc</span><span class="o">,</span> <span class="kt">int</span> <span class="n">inputBufferId</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ByteBuffer</span> <span class="n">inputBuffer</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="na">getInputBuffer</span><span class="o">(</span><span class="n">inputBufferId</span><span class="o">);</span>
    <span class="c1">// fill inputBuffer with valid data</span>
    <span class="err">…</span>
    <span class="n">codec</span><span class="o">.</span><span class="na">queueInputBuffer</span><span class="o">(</span><span class="n">inputBufferId</span><span class="o">,</span> <span class="err">…</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kt">void</span> <span class="nf">onOutputBufferAvailable</span><span class="o">(</span><span class="n">MediaCodec</span> <span class="n">mc</span><span class="o">,</span> <span class="kt">int</span> <span class="n">outputBufferId</span><span class="o">,</span> <span class="err">…</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ByteBuffer</span> <span class="n">outputBuffer</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="na">getOutputBuffer</span><span class="o">(</span><span class="n">outputBufferId</span><span class="o">);</span>
    <span class="n">MediaFormat</span> <span class="n">bufferFormat</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="na">getOutputFormat</span><span class="o">(</span><span class="n">outputBufferId</span><span class="o">);</span> <span class="c1">// option A</span>
    <span class="c1">// bufferFormat is equivalent to mOutputFormat</span>
    <span class="c1">// outputBuffer is ready to be processed or rendered.</span>
    <span class="err">…</span>
    <span class="n">codec</span><span class="o">.</span><span class="na">releaseOutputBuffer</span><span class="o">(</span><span class="n">outputBufferId</span><span class="o">,</span> <span class="err">…</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kt">void</span> <span class="nf">onOutputFormatChanged</span><span class="o">(</span><span class="n">MediaCodec</span> <span class="n">mc</span><span class="o">,</span> <span class="n">MediaFormat</span> <span class="n">format</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Subsequent data will conform to new format.</span>
    <span class="c1">// Can ignore if using getOutputFormat(outputBufferId)</span>
    <span class="n">mOutputFormat</span> <span class="o">=</span> <span class="n">format</span><span class="o">;</span> <span class="c1">// option B</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kt">void</span> <span class="nf">onError</span><span class="o">(</span><span class="err">…</span><span class="o">)</span> <span class="o">{</span>
    <span class="err">…</span>
  <span class="o">}</span>
 <span class="o">});</span>
 <span class="n">codec</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="n">format</span><span class="o">,</span> <span class="err">…</span><span class="o">);</span>
 <span class="n">mOutputFormat</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="na">getOutputFormat</span><span class="o">();</span> <span class="c1">// option B</span>
 <span class="n">codec</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
 <span class="c1">// wait for processing to complete</span>
 <span class="n">codec</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
 <span class="n">codec</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
</code></pre></div></div>

<p>个人认为在有数据源的情况下用这个, 比如已经有了图片要合成视频之类的
MediaCodec is typically used like this in synchronous mode:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MediaCodec</span> <span class="n">codec</span> <span class="o">=</span> <span class="n">MediaCodec</span><span class="o">.</span><span class="na">createByCodecName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
 <span class="n">codec</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="n">format</span><span class="o">,</span> <span class="err">…</span><span class="o">);</span>
 <span class="n">MediaFormat</span> <span class="n">outputFormat</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="na">getOutputFormat</span><span class="o">();</span> <span class="c1">// option B</span>
 <span class="n">codec</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
 <span class="k">for</span> <span class="o">(;;)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">inputBufferId</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="na">dequeueInputBuffer</span><span class="o">(</span><span class="n">timeoutUs</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">inputBufferId</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ByteBuffer</span> <span class="n">inputBuffer</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="na">getInputBuffer</span><span class="o">(</span><span class="err">…</span><span class="o">);</span>
    <span class="c1">// fill inputBuffer with valid data</span>
    <span class="err">…</span>
    <span class="n">codec</span><span class="o">.</span><span class="na">queueInputBuffer</span><span class="o">(</span><span class="n">inputBufferId</span><span class="o">,</span> <span class="err">…</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kt">int</span> <span class="n">outputBufferId</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="na">dequeueOutputBuffer</span><span class="o">(</span><span class="err">…</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">outputBufferId</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ByteBuffer</span> <span class="n">outputBuffer</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="na">getOutputBuffer</span><span class="o">(</span><span class="n">outputBufferId</span><span class="o">);</span>
    <span class="n">MediaFormat</span> <span class="n">bufferFormat</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="na">getOutputFormat</span><span class="o">(</span><span class="n">outputBufferId</span><span class="o">);</span> <span class="c1">// option A</span>
    <span class="c1">// bufferFormat is identical to outputFormat</span>
    <span class="c1">// outputBuffer is ready to be processed or rendered.</span>
    <span class="err">…</span>
    <span class="n">codec</span><span class="o">.</span><span class="na">releaseOutputBuffer</span><span class="o">(</span><span class="n">outputBufferId</span><span class="o">,</span> <span class="err">…</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">outputBufferId</span> <span class="o">==</span> <span class="n">MediaCodec</span><span class="o">.</span><span class="na">INFO_OUTPUT_FORMAT_CHANGED</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Subsequent data will conform to new format.</span>
    <span class="c1">// Can ignore if using getOutputFormat(outputBufferId)</span>
    <span class="n">outputFormat</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="na">getOutputFormat</span><span class="o">();</span> <span class="c1">// option B</span>
  <span class="o">}</span>
 <span class="o">}</span>
 <span class="n">codec</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
 <span class="n">codec</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
</code></pre></div></div>

<blockquote>
  <p>问题 请看下图, 从Hal上来的数据第一秒的时候是无效的video的, 结束的时候要求多录一秒钟</p>
</blockquote>

<p><img src="https://github.com/skypx/BlogResource/raw/master/camera/video_audio_sync.png" alt="avatar" /></p>

<h2 id="问题描述">问题描述</h2>
<p>正常情况下,如果录像开启的话,Video和Audio是同时传上来的, 然后同时合成, 类似mediarecorder
这样的话就不用管, 视频和音频的同步问题了. 因为基本不会有延迟,
但是假如开始的一秒钟我没有video数据.但是停止的时候是以audio停止的, 这样的话我的视频不就少了
一秒的时间, 并且前面的video数据是垃圾帧数据</p>

<h2 id="思考">思考,</h2>

<p>那假如我多录一秒, 并且让前面的垃圾帧去掉在合成不就可以了,</p>

<h2 id="核心思路涉及公司代码-不能上传code">核心思路(涉及公司代码, 不能上传code)</h2>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">mFirstVideoFrameTimeUs</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//136899194595</span>
                <span class="n">mFirstVideoFrameTimeUs</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="na">presentationTimeUs</span><span class="o">;</span>
                <span class="c1">//第一帧为0</span>
                <span class="n">info</span><span class="o">.</span><span class="na">presentationTimeUs</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="c1">//第一帧解码, return</span>
                <span class="n">queueBuffer</span><span class="o">()</span>
                <span class="k">return</span>
            <span class="o">}</span>

<span class="c1">//每次来算时间的gap 136899227943 这个数在增大,帧的时间戳肯定是在增大</span>
<span class="kt">long</span> <span class="n">timeSinceVideoStart</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="na">presentationTimeUs</span> <span class="o">-</span> <span class="n">mFirstVideoFrameTimeUs</span><span class="o">;</span>
<span class="c1">//33348 是33毫秒 比如1秒30帧, 1帧就是33毫秒左右</span>
<span class="n">info</span><span class="o">.</span><span class="na">presentationTimeUs</span> <span class="o">=</span> <span class="n">timeSinceVideoStart</span> <span class="o">-</span> <span class="n">mVideoOffset</span><span class="o">;</span>

<span class="err">接着我们就可以拿出来一副这样的数据</span>
<span class="mi">0</span>         <span class="mi">1</span>         <span class="mi">2</span>          <span class="mi">3</span>          <span class="mi">4</span>
<span class="mi">0</span>         <span class="mi">33348</span>     <span class="mi">66695</span>      <span class="mi">100042</span>     <span class="mi">133397</span>
<span class="err">每一帧到第一帧的时间</span>

</code></pre></div></div>
<p>为什么要计算时间, 因为我们记录了开始的时间和结束的时间,然后我们录了多长时间也知道,停止的时候我们不就可以达到多录的目的了.</p>

                </div>
                <div class="read-all">
                    <a  href="/2019/06/15/data_video&audio&sync/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2019/06/14/data_Linux&Mac&history/">Linux 和 Mac下快速搜索历史命令</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2019-06-14
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#工具" title="Category: 工具" rel="category">工具</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#Linux" title="Tag: Linux" rel="tag">Linux</a>&nbsp;
    
        <a href="/tag/#与" title="Tag: 与" rel="tag">与</a>&nbsp;
    
        <a href="/tag/#Mac" title="Tag: Mac" rel="tag">Mac</a>&nbsp;
    
        <a href="/tag/#搜索历史命令" title="Tag: 搜索历史命令" rel="tag">搜索历史命令</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    
<blockquote>
  <p>在Linux 或者 Mac系统中如何快速搜索已经使用过的命令?</p>
</blockquote>

<ul>
  <li>
    <p>在Linux中我们可以用history查询已经使用过的命令</p>
  </li>
  <li>
    <p>并且还可以用 Ctrl + R 来搜索已经用过的命令</p>
  </li>
  <li>
    <p>我们用一种更快的方式来搜索, 你忘记了以前输入过的某个命令, 只记得开头的几个字母, 没关系
 下面我们看看怎么快速补全</p>
  </li>
</ul>

<ol>
  <li>进入你的用户目录下.建立.inputrc文件</li>
  <li>
    <p>输入以下内容</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="s">"\e[A"</span><span class="o">:</span> <span class="n">history</span><span class="o">-</span><span class="n">search</span><span class="o">-</span><span class="n">backward</span>
 <span class="s">"\e[B"</span><span class="o">:</span> <span class="n">history</span><span class="o">-</span><span class="n">search</span><span class="o">-</span><span class="n">forward</span>
 <span class="n">set</span> <span class="n">show</span><span class="o">-</span><span class="n">all</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="n">ambiguous</span> <span class="n">on</span>
 <span class="n">set</span> <span class="n">completion</span><span class="o">-</span><span class="n">ignore</span><span class="o">-</span><span class="k">case</span> <span class="n">on</span>
</code></pre></div>    </div>
  </li>
  <li>保存, 执行 bind -f .inputrc</li>
</ol>

<p>然后你随便输入几个命令. ls, pwd, cd, ….
这个时候想输入pwd, 只用输入p 然后按键盘上键, 命令自动补充完毕. 大大提升工作效率!!</p>

                </div>
                <div class="read-all">
                    <a  href="/2019/06/14/data_Linux&Mac&history/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2019/06/14/data_androidtargetsdk/">关于minsdk, targetsdk, maxsdk</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2019-06-14
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Android" title="Category: Android" rel="category">Android</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#Android" title="Tag: Android" rel="tag">Android</a>&nbsp;
    
        <a href="/tag/#SDK" title="Tag: SDK" rel="tag">SDK</a>&nbsp;
    
        <a href="/tag/#区别" title="Tag: 区别" rel="tag">区别</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#语法" id="markdown-toc-语法">语法</a></li>
  <li><a href="#属性" id="markdown-toc-属性">属性</a>    <ul>
      <li><a href="#androidminsdkversion" id="markdown-toc-androidminsdkversion"><code class="highlighter-rouge">android:minSdkVersion</code></a></li>
      <li><a href="#androidtargetsdkversion" id="markdown-toc-androidtargetsdkversion"><code class="highlighter-rouge">android:targetSdkVersion</code></a></li>
      <li><a href="#androidmaxsdkversion" id="markdown-toc-androidmaxsdkversion"><code class="highlighter-rouge">android:maxSdkVersion</code></a></li>
    </ul>
  </li>
  <li><a href="#总结" id="markdown-toc-总结">总结</a>    <ul>
      <li><a href="#参考google" id="markdown-toc-参考google">参考Google:</a></li>
      <li><a href="#窥一斑而知全貌下面是网上看到的一个总结挺好的" id="markdown-toc-窥一斑而知全貌下面是网上看到的一个总结挺好的">窥一斑而知全貌,下面是网上看到的一个总结挺好的:</a>        <ul>
          <li><a href="#targetsdkversion24--手机的版本60" id="markdown-toc-targetsdkversion24--手机的版本60">targetSdkVersion（24） &gt; 手机的版本（6.0）</a></li>
          <li><a href="#手机的版本--targetsdkversion" id="markdown-toc-手机的版本--targetsdkversion">手机的版本 &gt; targetSdkVersion</a></li>
          <li><a href="#手机的版本--targetsdkversion-1" id="markdown-toc-手机的版本--targetsdkversion-1">手机的版本 = targetSdkVersion</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>详解targetsdk</p>
</blockquote>

<h2 id="语法">语法</h2>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">sdk</span> <span class="nl">android:</span><span class="n">minSdkVersion</span><span class="o">=</span><span class="s">"integer"</span>
          <span class="nl">android:</span><span class="n">targetSdkVersion</span><span class="o">=</span><span class="s">"integer"</span>
          <span class="nl">android:</span><span class="n">maxSdkVersion</span><span class="o">=</span><span class="s">"integer"</span> <span class="o">/&gt;</span>
</code></pre></div></div>
<h2 id="属性">属性</h2>
<h3 id="androidminsdkversion"><code class="highlighter-rouge">android:minSdkVersion</code></h3>

<p>一个用于指定应用运行所需最低 API 级别的整数。 如果系统的 API 级别低于该属性中指定的值，Android 系统将阻止用户安装应用。 您应该始终声明该属性.</p>

<p>注意：如果您不声明该属性，系统将假定默认值为“1”，这表示您的应用兼容所有 Android 版本。 如果您的应用并不兼容所有版本（例如，它使用 API 级别 3 中引入的 API），并且您尚未声明正确的 minSdkVersion，则当应用安装在 API 级别小于 3 的系统上时，应用将在运行时尝试访问不可用的 API 时发生崩溃。 因此，请务必在 minSdkVersion 属性中声明合适的 API 级别。</p>

<h3 id="androidtargetsdkversion"><code class="highlighter-rouge">android:targetSdkVersion</code></h3>

<p>一个用于指定应用的目标 API 级别的整数。如果未设置，其默认值与为 minSdkVersion 指定的值相等。
该属性用于通知系统，您已针对目标版本进行测试，并且系统不应启用任何兼容性行为来保持您的应用与目标版本的向前兼容性。 应用仍可在较低版本上运行（最低版本为 minSdkVersion）。</p>

<p>在 Android 随着每个新版本的推出而进化的过程中，一些行为甚至是外观可能会发生变化。不过，如果平台的 API 级别高于您的应用的 targetSdkVersion 所声明的版本，系统就可以通过启用兼容性行为来确保您的应用继续以您所期望的方式工作。 您可以通过将 targetSdkVersion 指定为与应用所运行平台的 API 级别一致来停用此类兼容性行为。 例如，如果将该值设置为“11”或更高，系统便可在您的应用运行在 Android 3.0 或更高版本的平台上时对其应用新的默认主题 (Holo)，还可在您的应用运行在更大屏幕上时停用屏幕兼容性模式（因为对 API 级别 11 的支持隐含了对更大屏幕的支持）。</p>

<p>系统可根据您为该属性设置的值启用许多兼容性行为。 Build.VERSION_CODES 参考资料中的相应平台版本对其中的几种行为做了说明。</p>

<p>要让您的应用与各 Android 版本保持同步，您应该增加该属性的值，使其与最新 API 级别一致，然后在相应平台版本上对您的应用进行全面测试。</p>

<p>引入的版本：API 级别 4</p>

<h3 id="androidmaxsdkversion"><code class="highlighter-rouge">android:maxSdkVersion</code></h3>

<p>一个指定作为应用设计运行目标的最高 API 级别的整数。
在 Android 1.5、1.6、2.0 及 2.0.1 中，系统会在安装应用以及系统更新后重新验证应用时检查该属性的值。 在任一情况下，如果应用的 maxSdkVersion 属性低于系统本身使用的 API 级别，系统均不允许安装应用。 在系统更新后重新验证这种情况下，这实际上相当于将您的应用从设备中移除。</p>

<p>为说明该属性在系统更新后对您的应用的影响，请看看下面这个示例：</p>

<p>Google Play 上发布了一个在其清单中声明了 maxSdkVersion=”5” 的应用。 一位设备运行 Android 1.6（API 级别 4）的用户下载并安装了该应用。 几周后，该用户收到了 Android 2.0（API 级别 5）OTA 系统更新。 更新安装后，系统检查该应用的 maxSdkVersion 并顺利完成了对其的重新验证。 应用仍可照常工作。 不过，一段时间后，设备又收到了一个系统更新，这次是更新到 Android 2.0.1（API 级别 6）。 更新完成后，系统无法再重新验证应用，因为此时系统本身的 API 级别 (6) 已超过该应用支持的最高级别 (5)。 系统会使该应用对用户不可见，这实际上相当于将它从设备上删除。</p>

<p>警告：不建议声明该属性。 首先，没有必要设置该属性，将其作为阻止您的应用部署到 Android 平台新发布版本上的一种手段。 从设计上讲，新版本平台完全向后兼容。 只要您的应用只使用标准 API 并遵循部署最佳实践，应该能够在新版本平台上正常工作。 其次，请注意在某些情况下，声明该属性可能导致您的应用在系统更新至更高 API 级别后被从用户设备中移除。 大多数可能安装您的应用的设备都会定期收到 OTA 系统更新，因此您应该在设置该属性前考虑这些更新对您的应用的影响。</p>

<h1 id="总结">总结</h1>

<h2 id="参考google">参考Google:</h2>
<p><a href="https://developer.android.com/guide/topics/manifest/uses-sdk-element.html?hl=zh-cn">Targetsdk</a></p>

<ul>
  <li>minSdkVersion 和 maxSdkVersion 还好理解. 下面我重点说下tagetSdkVersion</li>
</ul>

<p>下面我举个列子: (以运行时权限为例子)
我有一个Android 6.0 系统的手机. 我写了一个app</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">sdk</span> <span class="nl">android:</span><span class="n">minSdkVersion</span><span class="o">=</span><span class="s">"15"</span>
          <span class="nl">android:</span><span class="n">targetSdkVersion</span><span class="o">=</span><span class="s">"28"</span>
          <span class="nl">android:</span><span class="n">maxSdkVersion</span><span class="o">=</span><span class="s">"28"</span> <span class="o">/&gt;</span>
</code></pre></div></div>
<p>这个时候毫无疑问我运行app的时候需要适配运行时权限的代码, 那巧了, 我不想写运行时权限的代码怎么办
可以, 你只需要把targetSdkVersion 设置小于23就可以了
为什么要设置小于23就可以了?</p>

<ul>
  <li>我们可以参考下链接:</li>
</ul>
<p><a href="http://androidxref.com/9.0.0_r3/xref/frameworks/base/core/java/android/content/res/Resources.java#161">http://androidxref.com/9.0.0_r3/xref/frameworks/base/core/java/android/content/res/Resources.java#161</a></p>

<p>可以看到里面根据了targetsdk的不同而设置了不一样的主题. 其实targetsdk就是为了设置兼容性的.
来确保你的App在新平台上面是否运行一些新特性.</p>

<h2 id="窥一斑而知全貌下面是网上看到的一个总结挺好的">窥一斑而知全貌,下面是网上看到的一个总结挺好的:</h2>
<h3 id="targetsdkversion24--手机的版本60">targetSdkVersion（24） &gt; 手机的版本（6.0）</h3>
<p>对应项目会运行手机版本内一切特性。譬如项目targetSdkVersion是24，那么项目里没做6.0权限管理，调用危险权限相机就会闪退（利大于弊）</p>

<h3 id="手机的版本--targetsdkversion">手机的版本 &gt; targetSdkVersion</h3>
<p>项目运行效果为targetSdkVersion 版本。譬如项目targetSdkVersion是22，那么项目里没做6.0（23）权限处理，调用危险权限如相机不会出现闪退和提示，照常运行，项目特性运行到22版本。</p>

<h3 id="手机的版本--targetsdkversion-1">手机的版本 = targetSdkVersion</h3>
<p>如果目标设备的API版本正好等于此数值， 他会告诉Android平台：此程序在此版本已经经过充分测，没有问题。不必为此程序开启兼容性检查判断的工作了。 也就是说，如果targetSdkVersion与目标设备的API版本相同时，运行效率可能会高一些。 但是，这个设置仅仅是一个声明、一个通知，不会有太实质的作用
用较低的 minSdkVersion 来覆盖最大的人群，用最新的 SDK 设置 targetSdkVersion和 compile 来获得最好的外观和行为。强烈推荐targetSdkVersion升到最新版本。</p>

<p>参考: <a href="https://www.jianshu.com/p/26eff76f7883">https://www.jianshu.com/p/26eff76f7883</a></p>

                </div>
                <div class="read-all">
                    <a  href="/2019/06/14/data_androidtargetsdk/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
        </ul>



        <!-- Pagination links -->
        <div class="pagination">
          
            <span class="previous disable"><i class="fa fa-angle-double-left"></i></span>
            <span class="previous disable"><i class="fa fa-angle-left"></i></span>
          
          <span class="page_number ">1/2</span>
          
            <a href="/page2" class="next"><i class="fa fa-angle-right"></i></a>
            <a href="/page2" class="next"><i class="fa fa-angle-double-right"></i></a>
          
        </div>
    </div>
    <!-- <button class="anchor"><i class="fa fa-anchor"></i></button> -->
    <div class="right">
        <div class="wrap">
            <div class="side">
                <div>
                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                    Recent Posts
                </div>
                <ul class="content-ul" recent>
                    
                        <li><a href="/2019/06/21/data_android&scroll/">Android ScrollTo, ScrollBy</a></li>
                    
                        <li><a href="/2019/06/20/data_Mac$Gedit/">Mac 下安装gedit</a></li>
                    
                        <li><a href="/2019/06/20/data_Linux$Mac&Terminal%E9%A2%9C%E8%89%B2%E4%BF%AE%E6%94%B9/">Linux 与 Mac下的Terminal颜色修改</a></li>
                    
                        <li><a href="/2019/06/15/data_video&audio&sync/">Video and Audio 的同步处理</a></li>
                    
                        <li><a href="/2019/06/14/data_Linux&Mac&history/">Linux 和 Mac下快速搜索历史命令</a></li>
                    
                        <li><a href="/2019/06/14/data_androidtargetsdk/">关于minsdk, targetsdk, maxsdk</a></li>
                    
                        <li><a href="/2019/06/12/data_markdown%E8%AF%AD%E6%B3%95/">Markdown语法</a></li>
                    
                        <li><a href="/2019/06/12/data_camerazsl/">Camera ZSL 拍照</a></li>
                    
                        <li><a href="/2019/06/12/data_cameraAPI1_API2/">Camera API1 - API2</a></li>
                    
                        <li><a href="/2019/06/11/data_Mac$Paste/">Mac 下的剪切操作</a></li>
                    
                </ul>
            </div>

            <!-- Content -->
            <div class="side ">
                <div>
                    <i class="fa fa-th-list"></i>
                    Categories
                </div>
                <ul class="content-ul" cate>
                    
                    <li>
                        <a href="/category/#工具" class="categories-list-item" cate="工具">
                            <span class="name">
                                工具
                            </span>
                            <span class="badge">5</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Camera" class="categories-list-item" cate="Camera">
                            <span class="name">
                                Camera
                            </span>
                            <span class="badge">3</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Android" class="categories-list-item" cate="Android">
                            <span class="name">
                                Android
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <div class="side">
                <div>
                    <i class="fa fa-tags"></i>
                    Tags
                </div>
                <div class="tags-cloud">
                    
                    
                    
                    

                    

                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Mac" style="font-size: 18pt; color: #000;">Mac</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#剪切" style="font-size: 9pt; color: #999;">剪切</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Camera" style="font-size: 18pt; color: #000;">Camera</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#API" style="font-size: 13.5pt; color: #444;">API</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#区别" style="font-size: 18pt; color: #000;">区别</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#拍照" style="font-size: 9pt; color: #999;">拍照</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Android" style="font-size: 13.5pt; color: #444;">Android</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#SDK" style="font-size: 9pt; color: #999;">SDK</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Linux" style="font-size: 9pt; color: #999;">Linux</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#与" style="font-size: 9pt; color: #999;">与</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#搜索历史命令" style="font-size: 9pt; color: #999;">搜索历史命令</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Video" style="font-size: 9pt; color: #999;">Video</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#and" style="font-size: 9pt; color: #999;">and</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Audio" style="font-size: 9pt; color: #999;">Audio</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Terminal" style="font-size: 9pt; color: #999;">Terminal</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Gedit" style="font-size: 9pt; color: #999;">Gedit</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Scroll" style="font-size: 9pt; color: #999;">Scroll</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#方法" style="font-size: 9pt; color: #999;">方法</a>
                    
                </div>
            </div>

            <!-- <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    Links
                </div>
                <ul  class="content-ul">

                </ul>
            </div> -->
        </div>
    </div>
</div>
<!-- <script src="/js/scroll.min.js " charset="utf-8"></script> -->
<!-- <script src="/js/pageContent.js " charset="utf-8"></script> -->


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
             本站记录我的 Android 之旅的沿途风景！ 
        </p>
        <p class="contact">
            Contact me at: 
            <a href="https://github.com/skypx" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:wpxwangshi@163.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>        
        </p>
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
            <span>
                Theme designed by <a href="https://github.com/Gaohaoyang">HyG</a>.
            </span>
        </p>
    </div>
</footer>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script type="text/javascript" charset="utf-8" src="https://changyan.itc.cn/js/lib/jquery.js"></script>
    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/prism.js " charset="utf-8"></script>
    <script src=" /js/smooth-scroll.min.js " charset="utf-8"></script>
    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });
    </script>
    <script type="text/javascript">
      $('pre').addClass("line-numbers");
    </script>
    <!-- <script src=" /js/scroll.min.js " charset="utf-8"></script> -->
  </body>

</html>
